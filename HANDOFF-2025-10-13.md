**Purpose:** Takeover readiness log
**Date:** 2025-10-13
**Project:** PROJECT_NAME

### TODAY'S PROGRESS
- Completed: ["Takeover preflight (CLAUDE.MD, clean repo, secret scan)", "Created fresh Vercel project sora2-ugc-app-clean and linked frontend/", "Synced .env.local secrets to production/preview/development and shipped prod deploy https://sora2-ugc-app-clean-hl9sntgja-brandontans-projects.vercel.app", "Ported /test-dashboard learnings into /dashboard: WaveSpeed-only provider, job tray, multi-run backgrounding", "Removed legacy 'Latest 5 runs' block to avoid tray duplication", "Implemented inline expand-in-place tray interaction so completed jobs can preview/download/clear without clutter", "Removed provider selector/labels so UI no longer surfaces WaveSpeed branding", "Fixed WaveSpeed unauthorized error by trimming quoted API key in server routes; live job generation working", "Sanitized Supabase service client env strings to handle stray quotes; linted, committed, deployed", "Normalized `start_sora_job` RPC response handling so array payloads surface job_id; redeployed and verified WaveSpeed launch 200 with request c27f48f5…", "Live-tested dashboard generation (9:16 • 4s • WaveSpeed) — job `1e03d60c-7317-465c-afb8-b70911a0ef79` queued, credits debited, tray status auto-refresh confirmed"]
- Blockers: ["Cannot assign genvidsfast.com: Vercel CLI reports no access to domain under brandontans-projects", "Fal jobs remain IN_QUEUE even after poller runs (no provider ack)", "Replicate Sora rejected key (org not verified) so no coverage yet", "WaveSpeed tray chip styling regresses (Preview pill protrudes) — needs design sweep"]
- Decisions: ["Keep new production project named sora2-ugc-app-clean with frontend/ root + node22", "Mirror runtime secrets 1:1 from .env.local across environments", "Hold domain cut-over until owner grants domain permissions or reassigns manually", "Hide provider branding entirely in dashboard UI (WaveSpeed is implementation detail)", "Use inline expand-in-place job tray UX rather than modal/hover variants", "Sanitize WaveSpeed API key (strip quotes) in backend before auth header", "Dashboard polls `/api/sora/jobs/:id` lazily from client until cron poller exists — keep for now but replace with server poller when built"]

### CURRENT FOCUS
- Working on: "Standing up reliable job refresh (client polling today, cron poller next)"
- Next immediate task: "Implement `/api/sora/poller` + schedule cron with ADMIN_DASHBOARD_TOKEN"

### ACTIVE CONFIGURATIONS
- branch = main
- env = local takeover
- vercel_project = sora2-ugc-app-clean (prod URL above)

### TOMORROW'S PRIORITIES
1. "Resolve access to genvidsfast.com and repoint to new deployment"
2. "Ship `/api/sora/poller` + schedule cron (WaveSpeed + Fal) so Supabase jobs update server-side"
3. "Stand up `/admin/jobs` telemetry/queue dashboard (jobs table + provider timeline + controls)"
4. "Polish dashboard tray styling (Preview chip overflow, Completed states, bell UX)"

### CONTEXT NEEDED
- ["Domain owner to grant access or reassign genvidsfast.com to sora2-ugc-app-clean", "Fal support on persistent IN_QUEUE state", "OpenAI org verification timeline for Sora access", "Design guidance for tray button styling + completion bell sound spec"]

### DEPLOYMENT NOTES (DO NOT SKIP)
1. `vercel project inspect sora2-ugc-app-clean` must show `Root Directory = frontend`, `Framework = Next.js`, `Build Command = npm run build`. If not, PATCH via API:  
   `curl -X PATCH https://api.vercel.com/v9/projects/prj_VSOWhcGJNhuZqVWfTmX1F61mVJAy \`  
   `  -H "Authorization: Bearer $VERCEL_TOKEN" -H "Content-Type: application/json" \`  
   `  -d '{"framework":"nextjs","buildCommand":"npm run build","installCommand":"npm install","rootDirectory":"frontend","devCommand":"npm run dev"}'`
2. Deploy from repo root (`frontend/` auto-resolved by project settings): `vercel deploy --prod --yes`.
3. Confirm 200 on deploy URL: `curl -I https://<deployment>.vercel.app` (expect `x-matched-path: /`).
4. If domain protection is enabled, disable or use bypass token before validation.
5. Alias domain to fresh deployment (requires domain access):  
   `vercel alias set https://<deployment>.vercel.app genvidsfast.com`
6. Verify alias resolves: `curl -I https://genvidsfast.com` (expect 200, cache HIT/PRERENDER).

### UX FLOW NOTES (do not lose)
- Production flow: login → OTP → Stripe credit pack purchase → generate video via upload/provider/settings.
- After submit: job moves into thumbnail tray; user must stay unblocked to start more jobs; show status per thumbnail; play bell when job completes.
- Test dashboard exists because production currently broken; it must allow job start, minimize to tray, permit immediate reruns, and support WaveSpeed.ai + Fal.ai while credits remain.
- If credits insufficient/low, surface warning to top up; cancel outstanding jobs via API when balance gone.
